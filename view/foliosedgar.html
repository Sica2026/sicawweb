<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Bitácora - SICA Admin</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Base Styles -->
    <link href="../css/base-styles.css" rel="stylesheet">
    <!-- Bitácora Styles -->
    <link href="../css/edgarfolios/bitacora-styles.css" rel="stylesheet">
</head>
<body class="admin-authenticated">
    <!-- Header Component -->
    <div id="header-component"></div>

    <!-- Navigation Component -->
    <div id="navbar-component"></div>

    <!-- Main Content Area -->
    <main class="main-content" id="main-content">
        <!-- Header Section -->
        <div class="container-fluid">
            <div class="bitacora-header">
                <div class="row align-items-center mb-4">
                    <div class="col-md-6">
                        <h1 class="bitacora-title">
                            <i class="bi bi-journal-text me-3"></i>
                            Bitácora de Control
                        </h1>
                        <p class="text-white">Gestión integral de folios y autorizaciones SICA</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-sica me-2" id="btnNuevoFolio">
                            <i class="bi bi-plus-circle me-2"></i>Nuevo Folio
                        </button>
                        <button class="btn btn-outline-warning position-relative" id="btnSICA">
                            <i class="bi bi-clipboard-check me-2"></i>SICA
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="sicaBadge">
                                0
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="container-fluid">
            <div class="filters-card mb-4">
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label-sica">Búsqueda en tiempo real</label>
                        <div class="search-input-group">
                            <i class="bi bi-search search-icon"></i>
                            <input type="text" class="form-control form-control-sica" 
                                   id="searchInput" placeholder="Buscar folio, nombre o comentarios...">
                            <div class="search-results-count" id="searchCount">0 resultados</div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label-sica">Fecha desde</label>
                        <input type="date" class="form-control form-control-sica" id="fechaDesde">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label-sica">Fecha hasta</label>
                        <input type="date" class="form-control form-control-sica" id="fechaHasta">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label-sica">Importancia</label>
                        <select class="form-select form-control-sica" id="filtroImportancia">
                            <option value="">Todas</option>
                            <option value="alta">Alta</option>
                            <option value="media">Media</option>
                            <option value="baja">Baja</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-secondary w-100" id="btnLimpiarFiltros">
                            <i class="bi bi-eraser me-2"></i>Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="container-fluid">
            <div class="row mb-4" id="statsCards">
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-icon bg-primary">
                            <i class="bi bi-files"></i>
                        </div>
                        <div class="stats-info">
                            <div class="stats-number" id="totalFolios">0</div>
                            <div class="stats-label">Total Folios</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-icon bg-warning">
                            <i class="bi bi-hourglass-split"></i>
                        </div>
                        <div class="stats-info">
                            <div class="stats-number" id="pendientesSica">0</div>
                            <div class="stats-label">Pendientes SICA</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-icon bg-success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="stats-info">
                            <div class="stats-number" id="autorizadosHoy">0</div>
                            <div class="stats-label">Autorizados Hoy</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-icon bg-info">
                            <i class="bi bi-calendar-week"></i>
                        </div>
                        <div class="stats-info">
                            <div class="stats-number" id="estaSemana">0</div>
                            <div class="stats-label">Esta Semana</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Folios Table -->
        <div class="container-fluid">
            <div class="card-modern">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-table me-2"></i>Lista de Folios
                    </h5>
                    <div class="table-controls">
                        <button class="btn btn-sm btn-outline-primary" id="btnExportar">
                            <i class="bi bi-download me-1"></i>Exportar
                        </button>
                        <div class="btn-group ms-2">
                            <button class="btn btn-sm btn-outline-secondary" id="btnVistaTabla">
                                <i class="bi bi-table"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="btnVistaCards">
                                <i class="bi bi-grid-3x3-gap"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Loading Spinner -->
                    <div class="loading-container text-center py-5" id="loadingSpinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <div class="mt-2 text-muted">Cargando folios...</div>
                    </div>

                    <!-- Table View -->
                    <div class="table-responsive" id="tableView" style="display: none;">
                        <table class="table table-sica">
                            <thead>
                                <tr>
                                    <th width="15%">Folio</th>
                                    <th width="25%">Nombre</th>
                                    <th width="15%">Fecha</th>
                                    <th width="10%">Importancia</th>
                                    <th width="25%">Comentarios</th>
                                    <th width="10%">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="foliosTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Cards View -->
                    <div class="cards-container p-3" id="cardsView" style="display: none;">
                        <div class="row" id="foliosCardsContainer">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- No Data Message -->
                    <div class="no-data-message" id="noDataMessage" style="display: none;">
                        <div class="text-center py-5">
                            <i class="bi bi-inbox display-1 text-muted"></i>
                            <h5 class="mt-3 text-muted">No hay folios registrados</h5>
                            <p class="text-muted">Agrega tu primer folio para comenzar</p>
                            <button class="btn btn-sica" onclick="document.getElementById('btnNuevoFolio').click()">
                                <i class="bi bi-plus-circle me-2"></i>Crear Primer Folio
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="container-fluid mt-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="pagination-info">
                    Mostrando <span id="paginationInfo">0-0 de 0</span> folios
                </div>
                <nav aria-label="Paginación de folios">
                    <ul class="pagination pagination-sm mb-0" id="paginationContainer">
                        <!-- Dynamic pagination -->
                    </ul>
                </nav>
            </div>
        </div>
    </main>

    <!-- Footer Component -->
    <div id="footer-component"></div>

    <!-- Modal Nuevo/Editar Folio -->
    <div class="modal fade" id="modalFolio" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalFolioTitle">Nuevo Folio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formFolio">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label-sica">Folio *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">CI/</span>
                                        <input type="number" class="form-control form-control-sica" 
                                               id="folioNumber" min="1" max="999" required>
                                        <span class="input-group-text">/2025</span>
                                    </div>
                                    <div class="form-text">Número consecutivo del folio</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label-sica">Fecha *</label>
                                    <input type="date" class="form-control form-control-sica" id="fechaFolio" required>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label class="form-label-sica">Nombre *</label>
                                    <input type="text" class="form-control form-control-sica" 
                                           id="nombreFolio" placeholder="Nombre del solicitante o tema" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label-sica">Importancia *</label>
                                    <select class="form-select form-control-sica" id="importanciaFolio" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="alta">Alta</option>
                                        <option value="media">Media</option>
                                        <option value="baja">Baja</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label-sica">Documento (Opcional)</label>
                                    <input type="file" class="form-control form-control-sica" 
                                           id="documentoFolio" accept=".pdf,.doc,.docx,.xls,.xlsx">
                                    <div class="form-text">PDF, Word o Excel (máx. 10MB)</div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label class="form-label-sica">Comentarios *</label>
                                    <textarea class="form-control form-control-sica" 
                                              id="comentariosFolio" rows="4" 
                                              placeholder="Descripción detallada del folio..." required></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-sica" id="btnGuardarFolio">
                        <i class="bi bi-save me-2"></i>Guardar Folio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal SICA Pendientes -->
    <div class="modal fade" id="modalSICA" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-clipboard-check me-2"></i>Pendientes SICA por Autorizar
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="loading-container text-center py-4" id="loadingSICA">
                        <div class="spinner-border text-warning" role="status"></div>
                        <div class="mt-2">Cargando pendientes...</div>
                    </div>
                    <div class="table-responsive" id="sicaTableContainer" style="display: none;">
                        <table class="table table-sica">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>No. Cuenta</th>
                                    <th>Carrera</th>
                                    <th>Tipo Autorización</th>
                                    <th>Fecha Solicitud</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="sicaTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                    <div class="no-pendientes" id="noPendientes" style="display: none;">
                        <div class="text-center py-4">
                            <i class="bi bi-check-circle display-1 text-success"></i>
                            <h5 class="mt-3">¡Todo al día!</h5>
                            <p class="text-muted">No hay pendientes por autorizar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <!-- Firebase Config -->
    <script src="../firebase-config.js"></script>
    <!-- Base Components JS -->
    <script src="../js/components.js"></script>
    <!-- Base Navigation JS -->
    <script src="../js/navigation.js"></script>
    <!-- Bitácora Modules -->
    <script src="../js/edgarfolios/bitacora-firebase.js"></script>
    <script src="../js/edgarfolios/bitacora-ui.js"></script>
    <script src="../js/edgarfolios/bitacora-filters.js"></script>
    <script src="../js/edgarfolios/bitacora-main.js"></script>
</body>
</html>