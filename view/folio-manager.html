<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Administración de Folios - SICA</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Base Styles -->
    <link href="../css/base-styles.css" rel="stylesheet">
    <!-- Admin Folios Styles -->
    <link href="../css/folio-manager.css" rel="stylesheet">
</head>
<body>
    <!-- Header Component -->
    <div id="header-component"></div>

    <!-- Navigation Component -->
    <div id="navbar-component"></div>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        <div class="container-fluid">
            <div class="row">
                <!-- Header con título y acciones -->
                <div class="col-12">
                    <div class="admin-header">
                        <div class="header-content">
                            <div class="header-info">
                                <h1 class="admin-title">
                                    <i class="bi bi-gear-fill text-gold"></i>
                                    Administración de Folios
                                </h1>
                                <p class="admin-subtitle">Sistema de gestión y control de documentos SICA</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-sica btn-custom-folio" id="btnCustomFolio">
                                    <i class="bi bi-plus-lg"></i>
                                    Folio Personalizado
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vista Principal: Buscador y Historial -->
            <div id="main-view" class="admin-section">
                <div class="row">
                    <!-- Buscador de Asesores -->
                    <div class="col-lg-8">
                        <div class="search-panel">
                            <div class="search-header">
                                <h3><i class="bi bi-search text-blue"></i> Buscar Asesor</h3>
                                <p>Busca y selecciona un asesor para generar documentos</p>
                            </div>
                            <div class="search-container">
                                <div class="search-input-wrapper">
                                    <input type="text" 
                                           class="form-control search-input" 
                                           id="searchAsesor" 
                                           placeholder="Escribe el nombre del asesor...">
                                    <i class="bi bi-search search-icon"></i>
                                    <div class="search-loading" id="searchLoading" style="display: none;">
                                        <div class="spinner-border spinner-border-sm text-gold" role="status">
                                            <span class="visually-hidden">Buscando...</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="search-results" id="searchResults"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Historial Reciente -->
                    <div class="col-lg-4">
                        <div class="history-panel">
                            <div class="history-header">
                                <h3><i class="bi bi-clock-history text-gold"></i> Historial Reciente</h3>
                                <span class="history-count" id="historyCount">0 registros</span>
                            </div>
                            <div class="history-list" id="historyList">
                                <div class="history-loading">
                                    <div class="spinner-border text-blue" role="status">
                                        <span class="visually-hidden">Cargando historial...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vista de Configuración: Aparece después de seleccionar asesor -->
            <div id="config-view" class="admin-section" style="display: none;">
                <div class="row">
                    <!-- Panel de Configuración -->
                    <div class="col-lg-6">
                        <div class="config-panel">
                            <div class="config-header">
                                <div class="config-title">
                                    <h3 id="configTitle">Configuración de Documento</h3>
                                    <div class="config-breadcrumb">
                                        <span id="selectedAsesorName">Asesor seleccionado</span>
                                        <i class="bi bi-chevron-right"></i>
                                        <span id="selectedDocType">Tipo de documento</span>
                                    </div>
                                </div>
                                <button class="btn btn-outline-secondary btn-sm" id="btnBackToSearch">
                                    <i class="bi bi-arrow-left"></i>
                                    Volver
                                </button>
                            </div>

                            <!-- Campo de Folio -->
                            <div class="folio-section">
                                <label for="folioInput" class="form-label-sica">
                                    <i class="bi bi-hash"></i>
                                    Número de Folio
                                </label>
                                <div class="folio-input-wrapper">
                                    <input type="text" 
                                        class="form-control form-control-sica" 
                                        id="folioInput" 
                                        placeholder="Ej: CI/001/2025">
                                    <button class="btn btn-outline-gold btn-sm" id="btnAutoFolio" title="Generar folio automático">
                                        <i class="bi bi-magic"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Acordeón de Configuración -->
                            <div class="accordion accordion-sica" id="configAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" 
                                                type="button" 
                                                data-bs-toggle="collapse" 
                                                data-bs-target="#configExtra" 
                                                aria-expanded="true" 
                                                aria-controls="configExtra">
                                            <i class="bi bi-gear-fill me-2"></i>
                                            Configuración Extra
                                        </button>
                                    </h2>
                                    <div id="configExtra" 
                                         class="accordion-collapse collapse show" 
                                         data-bs-parent="#configAccordion">
                                        <div class="accordion-body">
                                            <div class="config-form" id="configForm">
                                                <!-- Los campos se cargarán dinámicamente -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Botones de Acción -->
                            <div class="action-buttons">
                                <button class="btn btn-sica" id="btnSaveAndGenerate">
                                    <i class="bi bi-file-earmark-pdf"></i>
                                    Guardar y Generar PDF
                                </button>
                                <button class="btn btn-sica-outline" id="btnPreview">
                                    <i class="bi bi-eye"></i>
                                    Actualizar Vista Previa
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Panel de Previsualización -->
                    <div class="col-lg-6">
                        <div class="preview-panel">
                            <div class="preview-header">
                                <h3><i class="bi bi-eye text-blue"></i> Vista Previa</h3>
                                <div class="preview-controls">
                                    <button class="btn btn-sm btn-outline-secondary" id="btnZoomOut">
                                        <i class="bi bi-zoom-out"></i>
                                    </button>
                                    <span class="zoom-level" id="zoomLevel">100%</span>
                                    <button class="btn btn-sm btn-outline-secondary" id="btnZoomIn">
                                        <i class="bi bi-zoom-in"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="preview-container">
                                <div class="preview-document" id="previewDocument">
                                    <div class="preview-placeholder">
                                        <i class="bi bi-file-earmark-text"></i>
                                        <p>Selecciona un tipo de documento para ver la vista previa</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Selección de Documento -->
        <div class="modal fade" id="documentModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content modal-sica">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-file-text"></i>
                            Seleccionar Tipo de Documento
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="document-options" id="documentOptions">
                            <!-- Las opciones se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Folio Personalizado -->
        <div class="modal fade" id="customFolioModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content modal-sica">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-plus-circle"></i>
                            Agregar Folio Personalizado
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="customFolioForm">
                            <div class="mb-3">
                                <label for="customFolio" class="form-label-sica">Folio</label>
                                <input type="text" class="form-control form-control-sica" id="customFolio" required>
                            </div>
                            <div class="mb-3">
                                <label for="customName" class="form-label-sica">Nombre</label>
                                <input type="text" class="form-control form-control-sica" id="customName" required>
                            </div>
                            <div class="mb-3">
                                <label for="customDate" class="form-label-sica">Fecha</label>
                                <input type="date" class="form-control form-control-sica" id="customDate" required>
                            </div>
                            <div class="mb-3">
                                <label for="customComment" class="form-label-sica">Comentario</label>
                                <textarea class="form-control form-control-sica" id="customComment" rows="3" required></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-sica" id="btnSaveCustomFolio">
                            <i class="bi bi-save"></i>
                            Guardar Folio
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Component -->
    <div id="footer-component"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <!-- Firebase Config -->
    <script src="../firebase-config.js"></script>
    <!-- Base Components JS -->
    <script src="../js/components.js"></script>
    <!-- Base Navigation JS -->
    <script src="../js/navigation.js"></script>
    <!-- Document PDF Generators -->
    <script src="../js/documents/carta-aceptacion-FQ.js"></script>
    <script src="../js/documents/carta-aceptacion-prepa.js"></script>
    <script src="../js/documents/carta-termino-FQ-pdf.js"></script>
    <script src="../js/documents/carta-termino-prepa.js"></script>
    <!-- Admin Folio Modules -->
    <script src="../js/edgar/folio-manager.js"></script>
    <script src="../js/edgar/folio-search.js"></script>
    <script src="../js/edgar/folio-config.js"></script>
    <script src="../js/edgar/document-preview.js"></script>
</body>
</html>