<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Gestión Técnica - SICA</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Base Styles -->
    <link href="../css/base-styles.css" rel="stylesheet">
    <!-- Page Specific Styles -->
    <link id="page-styles" href="../css/tec.css" rel="stylesheet">
</head>
<body>
    <!-- Header Component -->
    <div id="header-component"></div>

    <!-- Navigation Component -->
    <div id="navbar-component"></div>

    <!-- Admin Authentication Check -->
    <div id="authCheck" class="loading-overlay show">
        <div class="loading-spinner">
            <div class="spinner-border text-gold" role="status">
                <span class="visually-hidden">Verificando acceso...</span>
            </div>
            <p class="loading-text">Verificando permisos de administrador...</p>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content tech-dashboard" id="main-content" style="display: none;">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h1 class="dashboard-title">
                            <i class="bi bi-tools text-gold me-3"></i>
                            Centro de Gestión Técnica
                        </h1>
                        <p class="dashboard-subtitle">Monitoreo y control de salas SICA</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="dashboard-controls">
                            <button class="btn btn-sica me-2" id="newReportBtn">
                                <i class="bi bi-plus-circle me-2"></i>Nuevo Reporte
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card stat-total">
                            <div class="stat-icon">
                                <i class="bi bi-clipboard-data"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalReports">0</h3>
                                <p>Reportes Totales</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card stat-pending">
                            <div class="stat-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendingReports">0</h3>
                                <p>Pendientes</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card stat-progress">
                            <div class="stat-icon">
                                <i class="bi bi-gear-fill"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="progressReports">0</h3>
                                <p>En Proceso</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="stat-card stat-resolved">
                            <div class="stat-icon">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="resolvedReports">0</h3>
                                <p>Resueltos</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="container-fluid">
                <div class="filters-card">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <label class="form-label-sica">Filtrar por Sala</label>
                            <select class="form-control form-control-sica" id="roomFilter">
                                <option value="all">Todas las Salas</option>
                                <option value="SICA 1">SICA 1</option>
                                <option value="SICA 2">SICA 2</option>
                                <option value="SICA 3">SICA 3</option>
                                <option value="SICA 4">SICA 4</option>
                                <option value="Salón Inteligente 1">Salón Inteligente 1</option>
                                <option value="Salón Inteligente 2">Salón Inteligente 2</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label-sica">Estado</label>
                            <select class="form-control form-control-sica" id="statusFilter">
                                <option value="all">Todos los Estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="en_proceso">En Proceso</option>
                                <option value="resuelto">Resuelto</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label-sica">Urgencia</label>
                            <select class="form-control form-control-sica" id="urgencyFilter">
                                <option value="all">Todos los Niveles</option>
                                <option value="urgente">Urgente</option>
                                <option value="moderado">Moderado</option>
                                <option value="bajo">Bajo</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label-sica">Vista</label>
                            <div class="btn-group view-toggle" role="group">
                                <button type="button" class="btn btn-sica-outline active" id="reportsView">
                                    <i class="bi bi-bug me-1"></i>Reportes
                                </button>
                                <button type="button" class="btn btn-sica-outline" id="servicesView">
                                    <i class="bi bi-tools me-1"></i>Servicios
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rooms Grid -->
        <div class="rooms-grid" id="roomsGrid">
            <div class="container-fluid">
                <div class="row" id="roomsContainer">
                    <!-- Las tarjetas de salas se generarán dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Reports/Services Table -->
        <div class="data-section">
            <div class="container-fluid">
                <div class="data-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4 class="mb-0" id="dataTableTitle">Reportes Técnicos</h4>
                        <div class="search-box">
                            <input type="text" class="form-control form-control-sica" id="searchInput" placeholder="Buscar...">
                            <i class="bi bi-search search-icon"></i>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sica" id="dataTable">
                            <thead id="tableHead">
                                <!-- Headers se generarán dinámicamente -->
                            </thead>
                            <tbody id="tableBody">
                                <!-- Datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                    <div class="table-pagination" id="tablePagination">
                        <!-- Paginación se generará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Component -->
    <div id="footer-component"></div>

    <!-- Modals -->
    <!-- New Report Modal -->
    <div class="modal fade" id="newReportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-futuristic">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-bug text-gold me-2"></i>
                        Nuevo Reporte Técnico
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newReportForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Sala</label>
                                <select class="form-control form-control-sica" id="reportRoom" required>
                                    <option value="">Seleccionar Sala</option>
                                    <option value="SICA 1">SICA 1</option>
                                    <option value="SICA 2">SICA 2</option>
                                    <option value="SICA 3">SICA 3</option>
                                    <option value="SICA 4">SICA 4</option>
                                    <option value="Salón Inteligente 1">Salón Inteligente 1</option>
                                    <option value="Salón Inteligente 2">Salón Inteligente 2</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Tipo de Servicio</label>
                                <select class="form-control form-control-sica" id="reportType" required>
                                    <option value="">Seleccionar Tipo</option>
                                    <option value="mantenimiento">Mantenimiento</option>
                                    <option value="instalacion">Instalación</option>
                                    <option value="software">Software</option>
                                    <option value="hardware">Hardware</option>
                                    <option value="limpieza">Limpieza</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Urgencia</label>
                                <select class="form-control form-control-sica" id="reportUrgency" required>
                                    <option value="">Seleccionar Urgencia</option>
                                    <option value="urgente">Urgente</option>
                                    <option value="moderado">Moderado</option>
                                    <option value="bajo">Bajo</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Responsable</label>
                                <input type="text" class="form-control form-control-sica" id="reportResponsible" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Estado</label>
                                <select class="form-control form-control-sica" id="reportStatus" required>
                                    <option value="">Seleccionar Estado</option>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="en_proceso">En Proceso</option>
                                    <option value="resuelto">Resuelto</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Fecha de Inicio</label>
                                <input type="date" class="form-control form-control-sica" id="reportStartDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Fecha de Término</label>
                                <input type="date" class="form-control form-control-sica" id="reportEndDate">
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label-sica">Descripción del Problema</label>
                                <textarea class="form-control form-control-sica" id="reportDescription" rows="4" required></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sica-outline" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-sica" id="saveReportBtn">
                        <i class="bi bi-save me-2"></i>Guardar Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Report Modal -->
    <div class="modal fade" id="editReportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-futuristic">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-pencil text-gold me-2"></i>
                        Editar Reporte Técnico
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editReportForm">
                        <input type="hidden" id="editReportId" />
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">ID del Reporte</label>
                                <input type="text" class="form-control form-control-sica" id="editReportIdDisplay" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Sala</label>
                                <input type="text" class="form-control form-control-sica" id="editReportRoom" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Tipo de Servicio</label>
                                <input type="text" class="form-control form-control-sica" id="editReportType" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Responsable</label>
                                <input type="text" class="form-control form-control-sica" id="editReportResponsible" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Urgencia</label>
                                <input type="text" class="form-control form-control-sica" id="editReportUrgency" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Estado</label>
                                <select class="form-control form-control-sica" id="editReportStatus" required>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="en_proceso">En Proceso</option>
                                    <option value="resuelto">Resuelto</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Fecha de Inicio</label>
                                <input type="date" class="form-control form-control-sica" id="editReportStartDate" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-sica">Fecha de Término</label>
                                <input type="date" class="form-control form-control-sica" id="editReportEndDate">
                                <small class="form-text text-muted">Opcional - Solo si el reporte está resuelto</small>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label-sica">Descripción del Problema</label>
                                <textarea class="form-control form-control-sica" id="editReportDescription" rows="4" required></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sica-outline" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-sica" id="updateReportBtn">
                        <i class="bi bi-check-circle me-2"></i>Actualizar Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-futuristic">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalTitle">Detalles</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detailModalBody">
                    <!-- Contenido se carga dinámicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sica-outline" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-sica" id="editItemBtn" style="display: none;">
                        <i class="bi bi-pencil me-2"></i>Editar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-border text-gold" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="loading-text">Procesando...</p>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <!-- Firebase Config -->
    <script src="../firebase-config.js"></script>
    <!-- Base Components JS -->
    <script src="../js/components.js"></script>
    <!-- Base Navigation JS -->
    <script src="../js/navigation.js"></script>
    <!-- ✅ ACCESO GLOBAL A MODO TÉCNICO (Alt + T desde cualquier página) -->
    <script src="../js/global-technician-shortcut.js"></script>
    <!-- Page Specific JS -->
    <script id="page-script" src="../js/tec.js"></script>
</body>
</html>